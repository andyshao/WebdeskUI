<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Pagebox</title>
<script type="text/javascript" src="Scripts/webdesk.ui.core.js"></script>
<link rel="stylesheet" type="text/css" href="Styles/pagebox.css" />
<script type="text/javascript" src="Scripts/events.js"></script>
<script type="text/javascript" src="Scripts/pagebox.js"></script>
<style type="text/css">
html, body {
	overflow: hidden;
}
#show {
	position: absolute;
	top: 0px;
	right: 0px;
}
h1:before {
	content: "\e77e";
	font-size: 40px;
	margin-right: 10px;
}
pre {
	padding: 20px;
	background-color: #FFC;
	width: calc(100% - 60px);
	border: dashed #ccc 1px;
}
table {
	background-color: #ccc;
	width: calc(100% - 20px);
}
table td {
	background-color: #fff;
}
th, td {
	height: 25px;
	line-height: 25px;
}
td {
	padding: 0px 10px 0px 10px;
}
table tr td:first-child {
	text-align: center;
	padding: 0px;
}
table tr td:first-child:before {
	content: 'on'
}
</style>
</head>

<body>
<div id="show"></div>
<div style="height: 150px">
  <h1 class="webdesk_icon" style="margin: 0px 0px 0px 20px">Pagebox.js 页面窗体</h1>
  <ul>
    <li>可拖放，可缩放，模拟windows桌面窗体</li>
    <li>上溯父级，操作父窗体文档对象，父子窗体可互动</li>
    <li>遍历下级，以及子对象的文档对象</li>
    <li>事件：多播事件，可追加、可去除</li>
  </ul>
</div>
<div style="height: calc(100% - 160px);max-width:1000px; padding-left: 20px; position: absolute;bottom: 0px;left:0px;overflow: auto;">
    <b>示例：</b>
    <pre>
     //创建窗体
    var box=$pagebox.create({
        width: 400,
        height: 300,
        right:10,
        top:10,
        url: 'pagebox -child.html',
        title: '可移动，可缩放；双击标题栏全屏'
    });
    box.open();
</pre>
 <b>属性：</b>
<div><p>所有的属性，必须在创建时设置，至少是在open()之前设置；否则不起作用。</p>
<p>主要原因是没有实现双向绑定，原计划是要这样的，不过现在还没有实现。</p></div>
<b>事件：</b>
<pre>
var box=$pagebox.create();
box.onclick(function(sender,e){
	//sender:为pagebox对象，即当前代码中的box
	//e:事件消息，例如e.x,e.y：当鼠标点击或移动事件的鼠标坐标
   });
box.open();</pre>
<table width="100%" border="0" cellspacing="1" cellpadding="1">
  <tr>
    <th scope="col" width="80px">事件</th>
    <th scope="col" width="180px">说明</th>
    <th scope="col" width="180px">参数sender</th>
    <th scope="col">参数e</th>
  </tr>
  <tr>
    <td>shown</td>
    <td>打开</td>
    <td>当前pagebox对象</td>
    <td>e.event：事件名称<br>
      e.action：动作，默认与e.event同值<br>
      e.target：响应事件的html元素，此处为窗体的html</td>
  </tr>
  <tr>
    <td>close</td>
    <td>关闭</td>
    <td>同上</td>
    <td>同上</td>
  </tr>
  <tr>
    <td>load</td>
    <td>加载完成，不管是否失败</td>
    <td>&nbsp;</td>
    <td>e.target：窗体iframe中的文档对象（document)<br>
      e.url：窗体iframe中的页面路径，即src的值</td>
  </tr>
  <tr>
    <td>fail</td>
    <td>加载失败</td>
    <td>&nbsp;</td>
    <td>同上</td>
  </tr>
  <tr>
    <td>click</td>
    <td>点击</td>
    <td>&nbsp;</td>
    <td>与onshown相同</td>
  </tr>
  <tr>
    <td>drag</td>
    <td>拖动位置</td>
    <td>&nbsp;</td>
    <td>e.target：窗体标题栏<br>
      e.mouse:鼠标当前坐标,{x,y}<br>
      e.move：移动的偏移量（相较于拖动之前）,{x,y}<br>
      e.offset:当前窗体的位置,{left,top}</td>
  </tr>
  <tr>
    <td>focus</td>
    <td>获取焦点</td>
    <td>&nbsp;</td>
    <td>与onshown相同</td>
  </tr>
  <tr>
    <td>blur</td>
    <td>失去焦点</td>
    <td>&nbsp;</td>
    <td>与onshown相同</td>
  </tr>
  <tr>
    <td>min</td>
    <td>最小化</td>
    <td>暂未实现</td>
    <td>与onshown相同</td>
  </tr>
  <tr>
    <td>full</td>
    <td>最大化</td>
    <td>&nbsp;</td>
    <td>与onshown相同</td>
  </tr>
  <tr>
    <td>restore</td>
    <td>还原</td>
    <td>&nbsp;</td>
    <td>e.action:如果是全屏还原，为from-full; 最小化还原为from-min</td>
  </tr>
  <tr>
    <td>resize</td>
    <td>缩放窗体大小</td>
    <td>&nbsp;</td>
    <td>e.mouse:鼠标当前坐标,{x,y}<br>
      e.move：移动的偏移量（相较于拖动之前）,{x,y}<br>
      e.offset:当前窗体的位置,{left,top}<br>
      e.width:缩放宽度<br>
      e.height:缩放高度<br>
      e.target:缩放控件<br>
      e.action:缩放的方向</td>
  </tr>
</table>
</div>
</body>
<script type="text/javascript">   
     //创建窗体
    var box=$pagebox.create({
        width: 400,
        height: 300,
        resize: true,
        right:10,
		top:10,
        url: 'pagebox -child.html',
        title: '可移动，可缩放；双击标题栏全屏'
    });
    box.title=box.id;
	box.onrestore(function(sender,e){
		console.log(e);
	});
    /*
    box.onfocus(function(sender,e){
        console.log('当前焦点窗体：'+sender.title);
    });*/
	//拖放和缩放
    var tm = function (sender, e) {		 
        var msg = 'x:' + e.mouse.x + "，y:" + e.mouse.y + '，movex:' + e.move.x + '，movey:' + e.move.y;
		if(e.width)msg+='，width:'+e.width;
		if(e.height)msg+='，height:'+e.height;
		$dom('#show').html(msg);
    };
    box.ondrag(tm).onresize(tm);
    box.open();
/*
    //
    var tm=pagebox.create({
        height: 200,
        width: 320,
        top: 40,
        left: 150,
        resize: false,
        min: false,
        max: false,
        //url: 'plan.html',
        url: 'http://www.weisha100.cn/mobile/default.ashx?skip=false',
        title: '禁止缩放'
    });
    tm.onload(function(sender,e){
        console.log(e.event);
    });
    tm.open();
    //直接创建
    var box = pagebox.create({
        height: 400,
        width: 320,
        top: 120,
        left: 450,
        min: true,
        max: false,
        //url: 'http://www.weisha100.cn/mobile/default.ashx?skip=false',
        title: '禁用最大化按钮'
    });
    
    box.onshown(function (sender, e) {
        console.log('onshown');
    });
    var tm = function (sender, e) {
        window.msg = '鼠标：x_' + e.mouse.x + ",y_" + e.mouse.y + ',移动：' + e.move.x + '，宽：' + e.width;
    };
    box.ondrag(tm).onresize(tm);
    box.onclick(function (sender, e) {
        console.log('onclick' + sender.title);
        return 'onlclick';
    });
    box.open();

    var res = box.onclick();
    //console.log(res);
    //box.init('测试事件');
    var last = $dom('.pagebox').last();

    //批量增加事件
    $ctrls.each(function() {
        this.onclose(function(sender, e) {
            var size = $ctrls.size();
            console.log('打开的窗体剩余:' + size);
        });
        this.onblur(function(sender, e) {
            console.log('失去焦点的窗体:' + sender.title);
        }).onfocus(function(sender, e) {
            console.log('获取焦点的窗体：' + sender.title);
        });
        this.onfull(function(s, e) {
            console.log('最大化：' + s.title);

        });
        this.onrestore(function(s, e) {
            console.log('还原窗体：' + s.title);

        });
        this.onfail(function(s,e){
            console.log('加载失败：'+e.url);
        });
    });*/
    //console.log($ctrls.size());
</script>
</html>